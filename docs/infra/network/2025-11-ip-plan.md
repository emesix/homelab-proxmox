# Homelab Network Plan – November 2025 (OPNsense /16)

> **⚠️ DEPRECATED:** This document is outdated as of December 2025.  
> **See instead:** `/docs/infra/network/2025-12-ip-plan-ACTUAL.md` for current deployment.  
> **Kept for historical reference only.**

> This document supersedes older 192.168.42.0/24-based plans.  
> The new design is based on OPNsense with a /16 LAN and Proxmox on all servers except the NAS.

## 1. Core assumptions

- **Router / firewall:** OPNsense running as a VM on `pve-qotom01` (Qotom 1U), WAN + LAN.
- **LAN network:** `192.168.0.0/16`
  - Gateway: `192.168.1.1` (OPNsense LAN)
  - DNS: OPNsense Unbound on `192.168.1.1`
- **DHCP range (clients):** `192.168.200.100 – 192.168.200.199`
  - Everything **below 192.168.200.0** is reserved for static infrastructure.

We use a simple convention for static IP addressing:

- `192.168.10.x` → Proxmox hypervisors (management)
- `192.168.20.x` → Storage (NAS, backup targets)
- `192.168.30.x` → Application servers & orchestrators (VMs/CTs)
- `192.168.40.x` → AI / GPU workers (bare metal or Proxmox nodes / VMs)
- `192.168.200.x` → Dynamic clients via DHCP

The physical network is currently a single LAN segment; segmentation by VLAN will be layered on later
(e.g. VLAN 10 = hypervisors, VLAN 20 = storage, VLAN 30 = apps, VLAN 40 = AI), but the IP plan is already
prepared for that.

## 2. Assigned infrastructure addresses

### 2.1 Proxmox hypervisors (management IPs)

These IPs are configured as the main management address on `vmbr0` for each Proxmox node.

| Hostname        | Role / Hardware (short)                           | Management IP   | Notes                                      |
|-----------------|---------------------------------------------------|-----------------|--------------------------------------------|
| `pve-qotom01`   | Qotom 1U, Atom C3758R, OPNsense-VM + hypervisor   | `192.168.10.11` | Primary edge / OPNsense host               |
| `pve-hx310-db`  | OnLogic HX310 (DB/Wiki/Vaultwarden, etc.)         | `192.168.10.12` | DB/services node                           |
| `pve-hx310-arr` | OnLogic HX310 (*ARR/media services)               | `192.168.10.13` | Media/*ARR node                            |
| `pve-5700g`     | Ryzen 7 5700G-class Proxmox node                  | `192.168.10.14` | General-purpose workloads / Docker-VMs     |
| `pve-8845hs`    | Ryzen 7 8845HS-class Proxmox node                 | `192.168.10.15` | Future workloads / lab                     |
| `pve-x2686-x2`  | Jingsha X99 dual E5-2686v4, 128 GB ECC, AI worker | `192.168.10.16` | Heavy AI/GPU workloads under Proxmox       |

### 2.2 Storage

| Hostname    | Role         | IP address      | Notes                                     |
|-------------|-------------|-----------------|-------------------------------------------|
| `nas-main`  | Primary NAS | `192.168.20.11` | Only non-Proxmox host; provides storage   |

The NAS is intentionally **not** running Proxmox. It is the stable storage layer (e.g. ZFS/TrueNAS/OMV)
that exposes NFS/SMB/iSCSI to the Proxmox cluster and other nodes.

### 2.3 Application / orchestration / AI ranges (planned)

These ranges are reserved for VMs, CTs and possibly a few bare-metal nodes in the future.

- `192.168.30.x` → Application VMs/CTs and orchestrator
  - Example future assignments:
    - `192.168.30.11` `ai-orch01.internal` – AI orchestrator VM (Mem0, Wiki integration, job dispatch)
    - `192.168.30.12` `docker-main.internal` – consolidated Docker LXC/VM if not running on NAS
- `192.168.40.x` → AI workers / model-serving endpoints
  - Example / future:
    - `192.168.40.11` `quasi-marvin.internal` – AI worker VM or bare-metal OS on top of `pve-x2686-x2`

These addresses are not yet fully pinned down; this document can be expanded once the VMs/CTs are created.

## 3. DHCP and client networks

- `192.168.200.100 – 192.168.200.199`: dynamic DHCP clients (laptops, phones, IoT, test VMs without static IP).
- All infrastructure hosts (Proxmox, NAS, orchestration VMs, AI workers) must use **static IPs** outside this range.

Example OPNsense LAN configuration (already in use):

- Interface LAN IP: `192.168.1.1/16`
- DHCP range: `192.168.200.100 – 192.168.200.199`
- DNS: Unbound, listening on `192.168.1.1` and serving `*.internal`.

## 4. OPNsense staging / fake internet network (for Qotom deployment)

For safely staging and deploying a new OPNsense instance on the Qotom device, a dedicated “fake WAN”
network is provided from the existing OPNsense box:

- Interface name: e.g. `QotomWANStaging` (OPT1)
- Network: `172.31.0.0/16`
  - Gateway: `172.31.0.1`
  - DHCP range: `172.31.0.50 – 172.31.0.150`
- Outbound NAT: automatic, so the 172.31.0.0/16 network is NATed to the real WAN.

Usage:

- Plug the **WAN** of the new Qotom/OPNsense into this interface (or a switch connected to it).
- Set the Qotom WAN to **DHCP**; it will receive an address like `172.31.0.x` with gateway `172.31.0.1`.
- This gives the Qotom real internet access, but safely double-NATed behind the existing OPNsense.

## 5. Next steps / TODO

- Add these hostnames and IPs as **Host Overrides** in OPNsense Unbound, so DNS matches `/etc/hosts`.
- When VLANs are introduced:
  - Map this IP plan to VLAN IDs (e.g. VLAN 10 = hypervisors, 20 = storage, 30 = apps, 40 = AI).
  - Add corresponding interfaces and firewall rules on OPNsense.
- Extend this document with:
  - Final list of application VMs/CTs (Wiki.js, Postgres, Vaultwarden, *ARR, AI orchestrator, etc.).
  - Any DMZ or guest networks that are added later.