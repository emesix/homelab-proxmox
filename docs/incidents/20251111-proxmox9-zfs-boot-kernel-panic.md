# 2025-11-11 – Proxmox 9.0 ZFS Boot Kernel Panic

## Summary

Attempting to install **Proxmox VE 9.0-1** with **ZFS root** on one of the hosts resulted in a
boot-time kernel panic:

> “unable to mount root fs on unknown-block(0,0)” (paraphrased from console output)

The same hardware boots **Proxmox VE 8.4** in UEFI mode without this problem.

## Timeline

- **2025-11-11 – Evening**
  - ISO: Proxmox VE 9.0-1.
  - Boot mode: UEFI, ZFS as root filesystem.
  - Installation appears to complete, but first boot fails with a kernel panic
    stating it cannot mount the root filesystem.
- **Same session**
  - Proxmox VE 8.4 ISO is tested on the same machine.
  - 8.4 boots correctly in UEFI mode (no panic).
- **Afterwards**
  - Decision (temporary): use Proxmox 8.x for this host and park 9.0 testing.

## Impact

- Cannot currently use Proxmox VE 9.0-1 on this specific host with ZFS root.
- Delays any cluster-wide upgrade plans to 9.x.
- Installation / reinstall time lost for this experiment.

## Suspected Root Cause (Hypotheses)

> **Note:** No definitive root cause yet; this section collects plausible explanations.

- **ZFS / initramfs mismatch**  
  The initramfs generated by the installer may be missing the correct ZFS modules or
  device driver needed to see the pool at boot.

- **UEFI boot entry / root parameter issue**  
  The kernel’s `root=` (or `boot=zfs:`) argument might not match the actual pool name,
  dataset, or ZFS cachefile.

- **Hardware / firmware quirk**  
  The specific NIC / storage controller / BIOS version might interact badly with the
  newer 6.x kernel / Proxmox 9 environment, but not with 8.4.

At this point, we treat this as an **open issue** that needs a controlled repro on
non-production hardware.

## Temporary Workaround

- Use **Proxmox VE 8.4** for the affected host(s).
- Keep cluster baselined on 8.x until:
  - Proxmox 9.x is better tested on local hardware,
  - or a documented fix / known issue is confirmed.

## Follow-up Actions

1. **Create a dedicated test VM or spare host**  
   - Install Proxmox 9.x with ZFS root.
   - Capture:
     - exact kernel panic message,
     - `/etc/default/grub` (or bootloader equivalent),
     - ZFS pool/dataset names.

2. **Compare boot config between 8.4 and 9.x**
   - Check:
     - `root=` / `boot=zfs:` parameters,
     - presence of ZFS modules in initramfs,
     - UEFI boot entries.

3. **Track upstream notes / changelog**
   - Watch for known issues around:
     - ZFS on root,
     - UEFI boot,
     - changes between 8.x and 9.x.

4. **Update ADRs and runbooks**
   - ADR-004 (Proxmox version & upgrade path) references this incident.
   - Once a fix is known, add a dedicated runbook for:
     - “Upgrading a Proxmox 8.x ZFS host to 9.x”.

## Lessons Learned

- **New major Proxmox versions must be tested on spare hardware first**, especially with:
  - ZFS root,
  - non-standard hardware (Qotom / HX310 / X99),
  - PCI passthrough scenarios.
- Keep a **known-good ISO (8.4)** around as a rescue / fallback baseline.
- Incidents like this should always produce:
  - an incident report,
  - at least one ADR,
  - and updates to the roadmap.
